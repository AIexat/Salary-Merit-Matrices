# Бюджетирование повышений зарплат: Валидация метода, Анализ ограничений и Оптимизаци (Merit Matrix Budgeting: Validation, Analysis, and Optimization)

## Автор
Алексей Иванов  
Итоговый проект программы «Специалист по Data Science», НИУ ВШЭ

---

## Содержание
1. [Краткое резюме](#краткое-резюме)
2. [Описание проблемы](#описание-проблемы)
3. [Структура проекта](#структура-проекта)
4. [Часть 1: Monte Carlo Validation](#часть-1-monte-carlo-validation)
5. [Часть 2: Анализ результатов](#часть-2-анализ-результатов)
6. [Часть 3: Генетический алгоритм - решение проблемы](#часть-3-генетический-алгоритм---решение-проблемы)
7. [Общие выводы](#общие-выводы)

---

## Краткое резюме

### TL;DR

**Гипотезы исследования:**

**H₀ (нулевая гипотеза):** Метод агрегированных распределений обеспечивает достаточную надежность бюджетирования (success rate ≥80%) независимо от размера группы сотрудников.

**H₁ (альтернативная гипотеза):** Надежность метода критически зависит от размера группы, и существует минимальный порог численности, ниже которого метод становится ненадежным (success rate <80%).

**Метод:** Monte Carlo симуляция на реальных рыночных данных (383,000+ сотрудников, 300+ компаний в Москве, референтная дата: 1 мая 2025). 2,921 функциональная группа, 1.7+ миллиардов тестовых сценариев.

**Результат:** H₀ отвергнута. 

**Главные выводы:** 
1. Метод математически корректен, но требует **300+ сотрудников** для минимальной надежности (92% success rate), **400+** для высокой надежности (98%)
2. Выявлена **"зона опасной иллюзии" (141-299 чел)**: обманчиво высокие средние SR (81-88%) маскируют реальный риск — 22-46% групп всё равно выходят за бюджет ±5%
3. **Парадокс высоких средних:** средняя SR=88% не гарантирует надежность из-за бимодального распределения
4. Метод **непригоден для 70-75% бизнес-контекстов** из-за недостижимости порога 300+ при функциональной сегментации

**Решение:** Разработан генетический алгоритм, который преодолевает выявленные ограничения

---

## Описание проблемы

### Что такое Merit Matrix?

**Merit Matrix (матрица повышений)** — инструмент HR для определения процента повышения зарплаты на основе двух параметров:

1. **Compa Ratio (CR)** — отношение текущей зарплаты к рыночной медиане или серединной точки в структуре вознаграждения (midpoint) для сотрудника:
   - CR < 1.0: ниже рынка
   - CR = 1.0: на рынке
   - CR > 1.0: выше рынка

2. **Performance Rating** — оценка эффективности сотрудника, определяемая непосредственным руковожителем (обычно от 3 до 7)

**Пример Merit Matrix 5×5:**

| CR / Rating | R1 | R2 | R3 | R4 | R5 |
|-------------|----|----|----|----|----| 
| < 0.80 | 6% | 10% | 14% | 17% | 20% |
| 0.80-0.90 | 5% | 9% | 12% | 15% | 18% |
| 0.90-1.10 | 3% | 7% | 10% | 13% | 16% |
| 1.10-1.20 | 2% | 5% | 8% | 11% | 13% |
| > 1.20 | 1% | 3% | 6% | 8% | 10% |

### Фундаментальная проблема прогнозирования бюджета

**Проблема временного разрыва:**
- **Q3-Q4:** HR утверждает бюджет на повышения
- **Q1:** Менеджеры присваивают рейтинги сотрудникам
- **Разрыв:** 3-6 месяцев между планированием и реализацией

**Что HR знает:**
- Выделенный бюджет на повышение заработных плат для группы сотрудников
- Merit Matrix (проценты повышений), которая разрабатывается самим HR
- Распределение сотрудников по диапазоном CR
- Целевое распределение рейтингов (10%-20%-40%-20%-10%), которое задается политикой или историческими данными

**Что HR не знает и не контролирует:**
- Какому конкретно сотруднику (с каким CR) какой рейтинг будет присвоен
- Будут ли менеджеры строго придерживаться заданного распределения

### Метод агрегированных распределений

HR использует формулу:

```
Ожидаемый бюджет = Σ P(CR_bin_i) × P(Rating_j) × Merit(i,j)
```

где:
- `P(CR_bin_i)` — доля сотрудников в CR-бине (известно из данных)
- `P(Rating_j)` — целевая доля рейтинга j (задается политикой)
- `Merit(i,j)` — процент из матрицы

**Почему "агрегированных распределений"?**
- Метод **агрегирует** (объединяет) два независимых распределения:
  1. Распределение сотрудников по CR bins (известно из данных)
  2. Целевое распределение рейтингов (задается HR политикой)

- Бюджет рассчитывается как математическое ожидание по этим распределениям

**Вопрос исследования:** Насколько точен этот метод в реальности? Как часто реальный бюджет попадает в заданный диапазон (например, ±5% от расчета по агрегированным распределениям)?
---

## Структура проекта
```
merit_matrix_project/
├── data/
│   └── Moscow.parquet.gzip                    # Подготовленные данные (конфиденциальны)
├── notebooks/
│   ├── 01_Monte_Carlo_Simulation.ipynb        # Часть 1: Симуляции
│   ├── 02_Results_Analysis.ipynb              # Часть 2: Анализ
│   └── 03_Genetic_Algorithm_Optimizer.ipynb   # Часть 3: Оптимизация
├── visualizations/
│   └── threshold_analysis.png                 # Графики
└── README.md                                  # Данный документ
```


## Часть 1: Monte Carlo Validation

### Цель

Проверить точность метода агрегированных распределений через симуляцию реальных сценариев присвоения рейтингов.

### Методология

**Для каждой группы сотрудников (Company × Function):**

1. **Рассчитать baseline:** бюджет по методу агрегированных распределений
2. **Провести 50,000 симуляций:**
   - Случайно присвоить рейтинги согласно целевому распределению
   - Добавить реалистичные вариации (Dirichlet distribution)
   - Рассчитать реальный бюджет по merit matrix
   - Проверить попадание в диапазон ±5%
3. **Рассчитать success rate:** % симуляций в пределах допуска

### Тестирование робастности

Для проверки устойчивости метода анализ проведен на **120 различных конфигурациях**:
- 6 вариантов CR bins (2-7)
- 5 вариантов ratings (3-7)
- 4 типа распределений (normal, skewed_high, skewed_low, uniform)

**Цель:** Убедиться, что результаты не зависят от конкретного дизайна матрицы.

### Данные

**Источник:** Исследование по вознаграждению Lens Consulting c референтной датой 1 мая 2025
- **Регион:** Москва
- **Сотрудников:** 383 483 сотрудника
- **Группировка:** Company × Function (2921 групп)
- **Размеры групп:** от 10 до 5000+ сотрудников

### Технические решения

#### Используемые библиотеки

**Обработка данных:**
- `pandas` — группировка по Company×Function, расчет медиан
- `numpy` — векторизованные операции с массивами

**Статистическое моделирование:**
- `scipy.stats.dirichlet` — моделирование вариаций распределения рейтингов
  - Параметр `concentration=250` создает отклонения ±2-3% от целевого распределения
  - Имитирует реальность: менеджеры следуют политике, но с небольшими исключениями

**Оптимизация производительности:**
- `numba` — JIT-компиляция критического цикла Monte Carlo
  - Ускорение в ~100 раз vs чистый Python
  - Параллелизация на все CPU cores (`@jit(parallel=True)`)
  - **Результат:** ~2-3 секунды на группу из 100 сотрудников (50K итераций)

#### Ключевые технические решения

**1. Подготовка данных**

```python
# Расчет Midpoint (медиана зарплат по Company×Function×Grade)
midpoints = df.groupby(['Company', 'Function', 'Grade'])['BP'].median()

# Расчет Compa Ratio для каждого сотрудника
CR = Base_Pay / Midpoint

# Агрегация: убираем Grade (CR уже учитывает позицию относительно грейда)
```

**Обоснование:** Использование медианы для устойчивости к выбросам; стандартная практика в compensation management.

**2. Генерация Merit Matrices**

Автоматическая генерация матриц с соблюдением принципов справедливости:
- Высокий рейтинг → больше повышение (70% влияния)
- Высокий CR → меньше повышение (30% влияния)
- Диапазон: 1% (worst case) до 20% (best case)

**3. Оптимизированный Monte Carlo**

**Векторизация:** Все случайные числа генерируются до основного цикла
```python
# Pre-generation для 50,000 итераций
all_sampled_probs = dirichlet.rvs(alpha, size=50000)  # Dirichlet samples
all_random_values = np.random.random((50000, n_employees))  # Uniform RV
```

**Numba JIT-компиляция:**
```python
@jit(nopython=True, parallel=True)
def _run_simulations_weighted(...):
    for sim_idx in prange(n_simulations):  # Параллельный цикл
        # Присвоение рейтингов
        # Расчет merit amounts
        # Проверка попадания в tolerance
```

**4. Класс FlexibleMeritAnalyzer**

Универсальный анализатор для матриц любого размера (2×3 до 7×7):
- `calculate_heuristic_budget()` — реализация метода агрегированных распределений
- `run_monte_carlo_for_group()` — 50,000 симуляций для одной группы
- `process_dataframe()` — обработка всех групп Company×Function с автофильтрацией малых выборок

#### Воспроизводимость

**Сохранение результатов:**
- Формат: Parquet (компактный, быстрый)
- Naming: `merit_analysis_{config_name}_{timestamp}.parquet`
- Метаданные: config_name, n_cr_bins, n_ratings, distribution_type

**Время выполнения:**
- Одна конфигурация (~300 групп): 10-15 минут
- Все 120 конфигураций: 2-4 часа на стандартном laptop (8 cores, 16GB RAM)

---

## Часть 2: Анализ результатов

### Корреляционная матрица
![Correlation Analysis](correlation.png)

### Анализ Success rate в зависимости от размера группы
![Threshold Analysis](threshold_analysis.png)

### Детальный сегментированный анализ по достижению допустимого уровня success rate (>= 80%)
![Detailed Analysis](detailed_segment_analysis.png)



# Success Rate Analysis: Комплексный анализ порогов надежности

**Примечание:** Success Rate (SR) — это процент итераций Monte Carlo симуляции, в которых итоговый бюджет попал в допустимый коридор ±5% от целевого значения. Например, SR=80% означает, что в 8 случаях из 10 (или 8 годах из 10) компания попадет в установленный бюджетный коридор. При целевом бюджете 100,000,000 допустимый диапазон составляет 95,000,000 - 105,000,000. Success Rate по сути показывает **надежность метода**: чем выше SR, тем реже компания будет выходить за пределы запланированного бюджета.

## Success rate по сегментам

| Сегмент | Размер группы | Mean/Median SR | Всего групп | **% групп SR≥80%** | **% групп SR≥90%** | Интерпретация |
|---------|---------------|----------------|-------------|-------------------|-------------------|---------------|
| **BP1** | <12 | 28.4% / 27.1% | 30,000 | **0.0%** | **0.0%** | ❌ **Катастрофа**: 100% групп выходят за бюджет |
| **BP2** | 12-16 | 32.2% / 30.7% | 56,880 | **0.0%** | **0.0%** | ❌ **Критично**: 100% групп за пределами бюджета |
| **BP3** | 17-24 | 38.1% / 36.8% | 57,840 | **0.0%** | **0.0%** | ❌ **Провал**: 100% групп выходят за бюджет |
| **BP4** | 25-38 | 45.5% / 44.4% | 54,600 | **0.0%** | **0.0%** | ❌ **Неприемлемо**: 100% групп за бюджетом |
| **BP5** | 39-63 | 55.2% / 54.2% | 49,680 | **0.4%** | **0.0%** | ❌ **Крайне рискованно**: 99.6% групп провалились |
| **BP6** | 64-140 | 68.0% / 68.8% | 51,240 | **26.4%** | **4.0%** | ❌ **Неприемлемо**: 3 из 4 групп за бюджетом |
| **BP7** | 141-199 | 81.2% / 82.7% | 14,880 | **54.2%** | **35.7%** | ⚠️ **"Зона иллюзии"**: Почти половина провалилась |
| **BP8** | 200-299 | 88.2% / 90.5% | 11,520 | **78.2%** | **50.9%** | ⚠️ **Недостаточно**: Каждая 5-я группа провалилась |
| **BP9** | 300-399 | 92.5% / 94.5% | 6,480 | **92.3%** | **67.4%** | ✅ **МИНИМАЛЬНО НАДЕЖНО**: ~8% групп провалились |
| **BP10** | 400-499 | 95.6% / 97.6% | 2,160 | **98.4%** | **86.6%** | ✅ **НАДЕЖНО**: Только 1.6% провалились |
| **BP11** | 500-999 | 97.7% / 99.4% | 8,040 | **99.3%** | **95.0%** | ✅ **Очень надежно**: <1% провалились |
| **BP12** | ≥1000 | 99.8% / 100.0% | 7,200 | **100.0%** | **99.9%** | ✅ **Абсолютно надежно**: 0% провалились |

---

## Ключевые выводы

### КРИТИЧЕСКИЕ ПОРОГИ НАДЕЖНОСТИ

#### Для достижения SR≥80% у 80%+ групп:
- **300-399 сотрудников** — первый порог, где **92.3% групп** достигают SR≥80%
- Это означает, что только **7.7% групп** всё ещё выходят за бюджет ±5%

#### Для достижения SR≥80% у 95%+ групп:
- **400-499 сотрудников** — **98.4% групп** достигают SR≥80%
- Только **1.6% групп** провалятся (менее 2 из 100)

#### Для достижения SR≥90% у 80%+ групп:
- **400-499 сотрудников** — **86.6% групп** достигают SR≥90%
- Это премиум-уровень надежности для строгого бюджетного контроля

#### Для абсолютной надежности:
- **1000+ сотрудников** — **100% групп** достигают SR≥80%, **99.9%** достигают SR≥90%

### КРИТИЧЕСКОЕ ОТКРЫТИЕ: "Зона иллюзии надежности"

**Сегменты 141-299 сотрудников — самая опасная зона:**

| Размер группы | Mean SR | % групп SR≥80% | % групп SR≥90% | Реальность |
|---------------|---------|----------------|----------------|------------|
| 141-199 | 81.2% | **54.2%** | **35.7%** | ⚠️ **Почти половина групп (45.8%) всё равно провалилась** |
| 200-299 | 88.2% | **78.2%** | **50.9%** | ⚠️ **Каждая 5-я группа (21.8%) за бюджетом** |

**Почему это критически опасно:**
1. **Обманчиво высокие средние** (81-88%) создают **ложное ощущение надежности**
2. На практике **21.8-45.8% групп регулярно выходят за бюджет** ±5%
3. Компании видят "среднюю" SR 81-88% и ошибочно считают это достаточным
4. **Даже при 200-299 сотрудниках** только 50.9% групп достигают SR≥90%

### ⚠️ Парадокс высоких средних значений

**Почему средняя SR=88.2%, но только 78.2% групп достигают SR≥80%?**

**Математическое объяснение:**
- **Бимодальное распределение**: Небольшая часть групп показывает SR=95-100%, сильно завышая среднее
- **Выбросы наверху**: 20-30% "звездных" групп с SR=90-100% тянут среднее вверх
- **Но**: Остальные 70-80% групп распределены в диапазоне 60-85%, многие ниже 80%

**Практический пример** (сегмент 200-299 чел):
```
Средняя SR = 88.2% (выглядит отлично!)
НО реальное распределение:
├── 50.9% групп: SR≥90% (успешные) ✅
├── 27.3% групп: SR 80-89% (на грани) ⚠️
└── 21.8% групп: SR<80% (провал) ❌

Компания видит "88%" и думает, что всё хорошо.
Реальность: каждая 5-я группа регулярно выходит за бюджет.
```

### Реальная картина по порогам

| Порог | % групп SR≥80% | % групп SR≥90% | Практический смысл |
|-------|----------------|----------------|-------------------|
| <64 чел | 0-0.4% | 0% | ❌ **Безнадежно**: 99.6-100% групп провалились |
| 64-140 чел | 26.4% | 4.0% | ❌ **Критично**: 3 из 4 групп провалились |
| 141-199 чел | 54.2% | 35.7% | ⚠️ **"Зона иллюзии"**: почти половина провалилась |
| 200-299 чел | 78.2% | 50.9% | ⚠️ **Недостаточно**: каждая 5-я группа провалилась |
| **300-399 чел** | **92.3%** | **67.4%** | ✅ **МИНИМАЛЬНО НАДЕЖНО**: только 7.7% провалились |
| **400-499 чел** | **98.4%** | **86.6%** | ✅ **НАДЕЖНО**: только 1.6% провалились |
| 500-999 чел | 99.3% | 95.0% | ✅ **Очень надежно**: <1% провалились |
| 1000+ чел | 100.0% | 99.9% | ✅ **Абсолютная надежность** |

### Итоговые критические пороги

**Уровни надежности:**

1. **Минимально приемлемый** (90% групп успешны): **300-399 сотрудников**
   - 92.3% групп с SR≥80%
   - Только 7.7% провалов

2. **Бизнес-надежный** (95% групп успешны): **400-499 сотрудников**
   - 98.4% групп с SR≥80%
   - Только 1.6% провалов

3. **Премиум** (99% групп успешны): **500-999 сотрудников**
   - 99.3% групп с SR≥80%
   - Менее 1% провалов

4. **Абсолютный** (100% групп успешны): **1000+ сотрудников**
   - 100% групп с SR≥80%
   - 0% провалов

---

## Парадокс практической применимости

**Реальность бизнеса:** Компании **не могут** применять единую матрицу ко всей организации из-за необходимости функциональной сегментации.

### Пример: компания 600 сотрудников
```
Сегментация по функциям:
├── Operations (180 чел)  → бюджет 6%, ~54% шанс SR≥80% ⚠️
├── Sales (150 чел)       → бюджет 7%, ~54% шанс SR≥80% ⚠️
├── IT (120 чел)          → бюджет 8%, ~26% шанс SR≥80% ❌
├── Finance (60 чел)      → бюджет 4%, ~26% шанс SR≥80% ❌
├── Admin/HR (50 чел)     → бюджет 3%, ~0.4% шанс SR≥80% ❌
└── Marketing (40 чел)    → бюджет 5%, ~0.4% шанс SR≥80% ❌
```

**Критическая проблема:** 
- **Ни одна функция не достигает порога 300+ человек** (минимально надежный)
- **Ни одна функция не имеет 90%+ вероятность успеха**
- Даже крупнейшие функции (150-180 чел) имеют только **54.2% шанс** достичь SR≥80%

**Реальный результат по функциям:**

| Функция | Размер | % вероятность SR≥80% | Ожидаемый результат |
|---------|--------|---------------------|---------------------|
| Operations | 180 | 54.2% | ⚠️ В половине лет выйдут за бюджет |
| Sales | 150 | 54.2% | ⚠️ В половине лет выйдут за бюджет |
| IT | 120 | 26.4% | ❌ В 3 из 4 лет выйдут за бюджет |
| Finance | 60 | 26.4% | ❌ В 3 из 4 лет выйдут за бюджет |
| Admin/HR | 50 | 0.4% | ❌ Практически всегда за бюджетом |
| Marketing | 40 | 0.4% | ❌ Практически всегда за бюджетом |

**Средневзвешенный успех по компании:**
- Только **~30-35% функций** попадут в бюджет в типичный год
- **65-70% функций** выйдут за бюджет ±5%

### Конфликт требований

| Требование статистики | Реальность бизнеса | Результат |
|----------------------|-------------------|-----------|
| **Нужно 300+ для 92% надежности** | **Ни одной функции >300 чел** | ❌ **100% функций ненадежны** |
| **Нужно 400+ для 98% надежности** | **Ни одной функции >400 чел** | ❌ **100% функций высокий риск** |
| Нужно 200+ для 78% шанса | Только 1 функция >200 чел | ❌ 83% функций провалятся |
| Нужно 141+ для 54% шанса | Только 2 функции >141 чел | ❌ 67% функций <50% шанс |
| Единая группа 600 чел | 6 разных бюджетов | ❌ Невозможно объединить |

---

## Масштабирование проблемы

### Компании 300-1,000 человек (средний бизнес)
```
Типичная структура:
├── 1-3 крупные функции (150-250 чел) → ~54-78% шанс SR≥80% ⚠️
├── 4-8 средних функций (60-140 чел)  → ~0.4-26% шанс SR≥80% ❌
└── 6-12 малых функций (<60 чел)      → ~0% шанс SR≥80% ❌
```

**КРИТИЧНО:** Ни одна функция не достигает надежного порога 300+

**Практический итог:** 
- **90-95% функций НЕ достигнут SR≥80% надежно**
- Даже "крупные" функции имеют только 50-80% шанс успеха в конкретный год
- В среднем только **1-2 функции из 10-15** будут стабильно успешны
- **Остальные 8-13 функций регулярно выходят за бюджет**

**Реальный сценарий** (компания 800 чел):
```
Функциональная структура (12 функций):
├── Operations (220 чел)      → 78% шанс ⚠️  → выйдет за бюджет в 1 из 5 лет
├── Sales (180 чел)           → 54% шанс ⚠️  → выйдет за бюджет в 1 из 2 лет
├── IT (140 чел)              → 26% шанс ❌  → выйдет за бюджет в 3 из 4 лет
├── Customer Service (100)    → 26% шанс ❌  → выйдет за бюджет в 3 из 4 лет
├── 8 других функций (<80)    → 0-4% шанс ❌ → почти всегда за бюджетом

Ожидаемый результат в типичный год:
✅ 1-2 функции попадут в бюджет (8-17%)
⚠️ 2-3 функции на грани (17-25%)
❌ 7-9 функций выйдут за бюджет (58-75%)
```

### Компании 1,000-3,000 человек
```
Типичная структура:
├── 2-4 крупные функции (250-450 чел)  → ~78-98% шанс SR≥80% ⚠️/✅
├── 6-10 средних функций (100-200 чел) → ~26-78% шанс SR≥80% ❌/⚠️
└── 12-20 малых функций (<100 чел)     → ~0-26% шанс SR≥80% ❌
```

**ВАЖНО:** Только 1-2 функции могут достичь 400-500 чел (надежная зона 98%)

**Практический итог:**
- **70-80% функций всё ещё работают с высоким риском** (<90% надежность)
- Только крупнейшие Operations (300-450 чел) приближаются к надежности
- Большинство функций в диапазоне 100-250 чел имеют только 26-78% шанс успеха

**Реальный сценарий** (компания 2,000 чел):
```
Функциональная структура (18 функций):
├── Operations (400 чел)      → 98% шанс ✅  → надежно
├── Sales (300 чел)           → 92% шанс ✅  → почти надежно
├── IT (250 чел)              → 78% шанс ⚠️  → каждый 5-й год провал
├── 5 функций (100-200 чел)   → 26-78% ⚠️/❌ → частые провалы
├── 10 функций (<100 чел)     → 0-26% ❌     → регулярные провалы

Ожидаемый результат в типичный год:
✅ 2-3 функции надежно в бюджете (11-17%)
⚠️ 4-6 функций на грани (22-33%)
❌ 9-12 функций выйдут за бюджет (50-67%)
```

### Компании 3,000-10,000 человек (крупный бизнес)
```
Типичная структура:
├── 3-6 гигантских функций (400-1000+ чел) → ~98-100% шанс SR≥80% ✅
├── 8-15 крупных функций (200-400 чел)     → ~78-98% шанс SR≥80% ⚠️/✅
├── 15-25 средних функций (80-200 чел)     → ~26-78% шанс SR≥80% ❌/⚠️
└── 20-40 малых функций (<80 чел)          → ~0-26% шанс SR≥80% ❌
```

**Практический итог:**
- **60-70% функций всё ещё работают с высоким риском** (<90% надежность)
- Только ~20-30% функций достигают надежного порога 300-400+
- Даже в крупных корпорациях большинство поддерживающих функций слишком малы

**Реальный сценарий** (компания 5,000 чел):
```
Функциональная структура (35 функций):
├── 5 гигантских (500-800 чел)  → 99-100% ✅  → абсолютно надежно
├── 8 крупных (250-400 чел)     → 78-98% ⚠️/✅ → в основном надежно
├── 15 средних (80-200 чел)     → 26-78% ❌/⚠️ → частые провалы
├── 7 малых (<80 чел)           → 0-26% ❌     → регулярные провалы

Ожидаемый результат в типичный год:
✅ 10-13 функций надежно (29-37%)
⚠️ 8-12 функций на грани (23-34%)
❌ 10-17 функций провалятся (29-49%)
```

---

## Итоговые выводы по функциям

Метод **фундаментально ненадежен** для подавляющего большинства функциональных структур:

| Тип функции | Типичный размер | % групп SR≥80% | Практическая надежность |
|-------------|----------------|----------------|------------------------|
| **Admin, HR, Legal, Marketing** | 20-80 чел | 0-26% | ❌ **74-100% лет провалятся** |
| **Finance, Procurement, Quality** | 60-120 чел | 0.4-26% | ❌ **74-99.6% лет провалятся** |
| **IT, Customer Service** | 100-180 чел | 26-54% | ❌ **46-74% лет провалятся** |
| **Sales (средние компании)** | 150-250 чел | 54-78% | ⚠️ **22-46% лет провалятся** |
| **Operations (средние компании)** | 200-300 чел | 78-92% | ⚠️ **8-22% лет провалятся** |
| **Operations (крупные компании)** | 300-500 чел | 92-98% | ✅ **2-8% лет провалятся** |
| **Гигантские функции** | 500+ чел | 99-100% | ✅ **0-1% лет провалятся** |

---

## Кто МОЖЕТ использовать метод надежно

### Надежно (92%+ групп успешны)

**Функции 300+ сотрудников:**
- Крупные Operations/Manufacturing (300-800 чел)
- Гигантские Sales в B2B корпорациях (300-600 чел)
- Массивные IT-отделы (300-700 чел)
- Огромные Call-centers (400-1000+ операторов)
- Логистические центры (300-600 чел)

**Доля компаний/функций:** **<15% всех бизнес-контекстов**

### "Зона опасной иллюзии" (54-78% успеха)

**Функции 141-299 человек:**
- Средние Operations (150-250 чел)
- Крупные IT-отделы (150-250 чел)
- Большие Sales-команды (150-250 чел)

**КРИТИЧЕСКИ ОПАСНО:** 
- Средние SR 81-88% создают **ложное ощущение надежности**
- **На практике 22-46% групп регулярно провалятся**
- Компании видят "88% среднее" и не осознают, что каждая 4-5-я группа выходит за бюджет
- Это **самый обманчивый диапазон** — выглядит хорошо, работает плохо

**Доля:** ~15-20% бизнес-контекстов

### Критически ненадежно (0-54% успеха)

**Охватывает:**
- **75%+ всех функциональных подразделений** (<141 чел)
- **90%+ компаний малого/среднего бизнеса** (<1000 чел)
- **65-75% функций в крупных компаниях** (1000-10000 чел)

**Итого:** **~70-75% всех бизнес-контекстов**

---

## Ключевой инсайт: "Закон 300+"

### Правило надежности

**Минимальный порог:** **300+ сотрудников** для 92.3% надежности (только 7.7% провалов)

**Рекомендуемый порог:** **400+ сотрудников** для 98.4% надежности (только 1.6% провалов)

**Абсолютная надежность:** **1000+ сотрудников** для 100% надежности (0% провалов)

### Практическая реальность

#### Кто может достичь порога 300+?

**Анализ по размеру компаний:**
- **<1,000 чел:** Обычно 0-1 функция ≥300 чел (**0-10% функций**)
- **1,000-3,000 чел:** Обычно 1-3 функции ≥300 чел (**10-20% функций**)
- **3,000-10,000 чел:** Обычно 3-8 функций ≥300 чел (**15-30% функций**)
- **10,000+ чел:** Обычно 10-20 функций ≥300 чел (**30-40% функций**)

**Итоговая статистика:**
- ✅ Менее **15-20% всех бизнес-контекстов** достигают порога 300+
- ⚠️ **20-25% контекстов** в "зоне иллюзии" (141-299 чел)
- ❌ **55-65% контекстов** критически малы (<141 чел)

### Парадокс метода

**Метод математически корректен**, но **практически неприменим** для подавляющего большинства реальных бизнес-структур.

**Четыре фундаментальных проблемы:**

1. **Проблема размера**: 80-85% функций не достигают порога 300+ человек

2. **Проблема сегментации**: Компании обязаны разбивать персонал на функции с разными бюджетами, что делает невозможным создание больших гомогенных групп

3. **Проблема "зоны иллюзии"** (141-299 чел): 
   - Обманчиво высокие средние (81-88% SR)
   - На практике 22-46% групп всё равно провалятся
   - Самая опасная зона — создает ложное чувство безопасности

4. **Проблема масштаба**: Даже компании в 5,000-10,000 человек имеют только 20-30% функций с достаточной надежностью

---

## 📊 Финальная матрица применимости

| Размер компании | % функций ≥300 чел | % функций в "зоне иллюзии" | % функций критично малы | Применимость метода |
|-----------------|-------------------|---------------------------|------------------------|---------------------|
| <500 чел | 0% | 10-20% | 80-90% | ❌ **Неприменимо** (0% надежных функций) |
| 500-1,000 чел | 0-10% | 15-25% | 65-85% | ❌ **Критично** (почти все функции ненадежны) |
| 1,000-3,000 чел | 10-20% | 20-30% | 50-70% | ⚠️ **Ограниченно** (только 1-3 функции надежны) |
| 3,000-10,000 чел | 15-30% | 25-35% | 35-60% | ⚠️ **Частично** (3-8 функций надежны, остальные нет) |
| 10,000+ чел | 30-40% | 30-35% | 25-40% | ✅ **Применимо** (10-20 функций надежны, но 60-70% всё равно ненадежны) |

**Общий вывод:** Метод применим только для **10-20% крупнейших функций** в **15-20% крупнейших компаний**. Для остальных **70-75% бизнес-контекстов** метод **фундаментально ненадежен**.

---

### Влияние других факторов (минимальное)

**Конфигурация матрицы:**
- Количество CR bins (2-7): разброс success rate 47-53% (±6%)
- Количество Ratings (3-7): разброс 48-54% (±6%)
- **Вывод:** Размер матрицы практически не влияет на точность

**Тип распределения рейтингов:**
- Разброс: 43-57% (14 процентных пунктов)
- **Вывод:** Умеренное влияние, значительно меньше размера группы

**Сводная таблица влияния:**

| Фактор | Разброс Success Rate | Влияние |
|--------|---------------------|---------|
| **Размер группы** | **33% → 98%** (65%) | ⭐⭐⭐⭐⭐ Критический |
| Тип распределения | 43% → 57% (14%) | ⭐⭐ Умеренное |
| Количество CR bins | 47% → 53% (6%) | ⭐ Минимальное |
| Количество Ratings | 48% → 54% (6%) | ⭐ Минимальное |

**Вывод:** Размер группы объясняет ~85-90% вариации в точности.


## Технические решения (Часть 2: Statistical Analysis & Validation)

## Используемые библиотеки

**Научные вычисления:**
* `pandas` — обработка табличных результатов Monte Carlo (350K+ групп)
* `numpy` — численные операции, векторизация расчетов

**Визуализация:**
* `matplotlib` — базовые графики, multi-panel dashboards
* `seaborn` — продвинутые визуализации (heatmaps, correlation matrices)

**Статистика и оптимизация:**
* `scipy.optimize.minimize` — оптимизация для piecewise regression
  * Метод: L-BFGS-B с bounded constraints
  * Цель: минимизация MSE при поиске breakpoints
* `scipy.stats` — корреляционный анализ (Pearson r), kernel density estimation
* `sklearn.metrics` — метрики качества регрессии (MSE для model selection)

## Ключевые технические решения

### 1. Univariate Analysis (Sections 1-6)

**Categorical encoding для корреляций:**
```python
# Ordinal encoding для сохранения порядка
size_bin_encoding = {'0-20': 1, '21-50': 2, ..., '500+': 6}
distribution_encoding = {'skewed_low': 1, 'uniform': 2, 'normal': 3, 'skewed_high': 4}
```

**Обоснование:** Pearson correlation требует числовые значения; ordinal encoding сохраняет смысловой порядок категорий.

**Adaptive binning стратегия:**
```python
# Для group size: неравномерные bins для захвата критических переходов
size_bins = [0, 20, 50, 100, 200, 500, np.inf]

# Для budget: равномерные bins для business relevance
budget_bins = [0, 5, 8, 10, 12, 15, np.inf]
```

### 2. Correlation Analysis (Section 7)

**Multi-dimensional correlation matrix:**
* Кодирование всех параметров как ordinal
* Расчет p-values для статистической значимости
* Интерпретация силы связи: |r| > 0.7 (Very Strong), > 0.4 (Strong), > 0.2 (Moderate)

**Ключевое открытие:** Group size объясняет 66.22 п.п. вариации (r=0.861), все остальные факторы — только 36 п.п.

### 3. Threshold Detection (Sections 8-9)

**Systematic ladder testing:**
```python
thresholds = [20, 30, 40, 50, 75, 100, 125, 150, 175, 200, 250, 300, 400, 500, 750, 1000]

for threshold in thresholds:
    below = df[df['n_employees'] < threshold]
    above = df[df['n_employees'] >= threshold]
    success_boost = above['success_rate'].mean() - below['success_rate'].mean()
```

**Метрики:**
* Success Boost — разница в mean success rate выше/ниже порога
* Identifies "jumps" — пороги с максимальным приростом точности

### 4. Sophisticated Methods (Section 10)

**Piecewise Linear Regression:**

Оптимизация breakpoints с constraints:
```python
def fit_piecewise_linear(x, y, n_segments, min_segment_size=1000):
    # Constraint: минимум 1000 групп в каждом сегменте
    # Objective: minimize MSE
    # Method: L-BFGS-B optimization
```

**Numerical stability:**
* Нормализация x перед fitting: `x_norm = (x - mean) / std`
* Пересчет slopes/intercepts в исходный масштаб
* Обработка edge cases (сегменты с 1 наблюдением)

**Model Selection via AICc:**
```python
# Corrected Akaike Information Criterion для finite samples
AIC = n * log(MSE) + 2*k
AICc = AIC + (2*k*(k+1)) / (n - k - 1)
```

**Балансирует:**
* Goodness of fit (минимизация MSE)
* Model complexity (penalty за количество параметров)
* **Результат:** Оптимальное число сегментов = arg min(AICc)

**Monotonicity check:**
```python
is_monotone = np.all(np.diff(y_pred) >= -1e-6)  # Success rate не должен падать
```

### 5. Local Analysis at Breakpoints

**Gaussian-weighted local mean:**
```python
# Adaptive window size: 1% данных или 30-200 групп
window_size = max(30, min(200, int(len(x) * 0.01)))

# Gaussian weights для smooth локального усреднения
weights = np.exp(-((x_local - x0)**2) / (2 * sigma**2))
local_mean = np.sum(weights * y_local)
```

**Bootstrap confidence intervals:**
* 1000 resamples для оценки 95% CI
* Weighted bootstrap с Gaussian weights
* Результат: понимание uncertainty в критических точках

### 6. Robust Threshold Detection — 4 метода

**Cross-validation подход:**
1. **Raw First-Hit** — первая группа ≥80%
2. **Smoothed First-Hit** — rolling mean (window=100) ≥80%
3. **Quantile-Based** — где P50/P60/P70 ≥80%
4. **Piecewise Model Crossing** — где fitted model пересекает 80%

**Consensus decision:** Если все методы дают похожие результаты → высокая уверенность в пороге.

### 7. Advanced Visualizations

**4-panel comprehensive view:**
```python
fig, axes = plt.subplots(2, 2, figsize=(16, 10))

# Panel 1: Detail view (0-2500) — фокус на критическом диапазоне
# Panel 2: Log scale — весь range данных
# Panel 3: Heatmap — 2D распределение (Size × Success Rate)
# Panel 4: Bar chart — success by segment с color coding
```

**Design principles:**
* Limited y-axis (0-105%) для удаления outliers
* Color coding: Red (<60%), Orange (60-80%), Green (≥80%)
* Breakpoint annotations с вертикальными линиями
* Median values внутри bars для robustness check

**Heatmap innovation:**
* Нормализация по столбцам → % within each segment
* Adaptive segment ranges на основе breakpoints
* Text annotations только для values >2% (избежание clutter)
* Adaptive text color: white на темном фоне, black на светлом

## Воспроизводимость

**Input:** `ALL_results.parquet` (результаты Monte Carlo из Части 1)

**Output:**
* Консольный вывод: summary statistics, correlation tables, threshold analysis
* Визуализации: `threshold_analysis.png` (300 DPI, high-resolution)
* Структурированные DataFrame для дальнейшего использования

**Время выполнения:**
* Loading data: 1-2 секунды (Parquet эффективен)
* Univariate analysis: ~5 секунд
* Piecewise regression (2-7 segments testing): ~30-60 секунд
  * Optimization computationally intensive для >350K observations
* Полный анализ: ~2-3 минуты на стандартном laptop

**Критические parameters:**
* `min_segment_size=1000` — статистическая значимость каждого сегмента
* `n_bootstrap=1000` — баланс точности CI и времени выполнения
* `window_pct=0.01` — локальное сглаживание (1% данных)

---

**Технический результат:** Математически строгая валидация метода с идентификацией точных пороговых значений (141-200 employees для перехода в зону надёжности) и количественной оценкой неопределённости для business decision making.

---

# Версия Части 3 для ПУБЛИЧНОГО репозитория

Замените весь текст Части 3 на это:

---

## Часть 3: Генетический алгоритм - решение проблемы

### ⚠️ Примечание о коде

Код генетического алгоритма является **коммерческой разработкой Lens Consulting** и используется в консалтинговых проектах. Полная реализация недоступна в публичном репозитории.

**Для комиссии HSE:** Полный код с технической документацией доступен в приватном репозитории `merit-matrix-private`.

Ниже представлены описание методологии и результаты применения алгоритма.

---

### Суть решения

**Проблема традиционного метода:**
- Метод агрегированных распределений предполагает независимость CR и рейтингов
- Не учитывает реальное распределение сотрудников по CR
- Требует 300+ человек для надежности
- Непригоден для 70-75% бизнес-контекстов

**Идея генетического алгоритма:**
- Использует реальное распределение сотрудников по CR в конкретной компании
- Оптимизирует матрицу под фактическую популяцию
- Валидирует каждую матрицу через Monte Carlo симуляцию
- Работает для групп от 18+ человек

### Принципиальное отличие подходов

**Метод агрегированных распределений:**
```
Шаг 1: Предполагает независимые распределения по CR и рейтингам
Шаг 2: Рассчитывает бюджет как математическое ожидание
Проблема: Не учитывает, что 70% сотрудников могут быть в одном CR-диапазоне
Результат: Работает только для 300+ человек
```

**Генетический алгоритм:**
```
Шаг 1: Видит, что у вас 70% сотрудников с CR = 0.95-1.05
Шаг 2: Создает матрицу, оптимизированную под это распределение
Шаг 3: Тестирует на 10,000 сценариев присвоения рейтингов
Результат: Работает для групп от 18+ человек, Success Rate 98-99%
```

### Методология (концептуально)

**1. Многокритериальная оптимизация**

Алгоритм ищет матрицу, которая одновременно:
- Попадает в целевой бюджет (±5%) в максимальном количестве сценариев
- Соблюдает принципы справедливости:
  - Высокий рейтинг → больше повышение
  - Высокий CR → меньше повышение
  - Видимая дифференциация между рейтингами
  - Защита от экстремальных значений

**2. Валидация через Monte Carlo**

Каждая кандидат-матрица тестируется на **10,000+ сценариев**:
- Случайное присвоение рейтингов согласно целевому распределению
- Вариации распределения (реалистичные отклонения)
- Стресс-тесты (grade inflation, harsh managers, etc.)
- Расчет Success Rate: % попаданий в бюджет ±5%

**3. Автоматическая policy guidance**

Для каждой оптимальной матрицы алгоритм генерирует рекомендации:
```
Rating 1: Target 10% | Допустимый диапазон: 8.2-11.8%
Rating 2: Target 15% | Допустимый диапазон: 13.1-16.9%
Rating 3: Target 50% | Допустимый диапазон: 48.3-51.7%
Rating 4: Target 15% | Допустимый диапазон: 13.2-16.8%
Rating 5: Target 10% | Допустимый диапазон: 8.3-11.7%
```

Это реалистичные границы, при которых бюджет соблюдается (на основе Monte Carlo).

---

### Результаты применения

**Валидация на реальных рыночных данных:**
```
Данные: 383,000+ сотрудников (Москва, 1 мая 2025)
Тест: 10 различных размеров групп (от 10 до 375 человек)
Целевой бюджет: ~8-9% от ФОТ
```

**Сравнение методов:**

| Размер группы | Традиционный метод SR | Генетический алгоритм SR | Улучшение |
|---------------|----------------------|-------------------------|-----------|
| 10 чел | 26.6% | 31.0% | +4.4 п.п. |
| 13 чел | 33.1% | 39.4% | +6.3 п.п. |
| **18 чел** | **41.4%** | **98.8%** | **+57.4 п.п.** ⭐ |
| **20 чел** | **39.6%** | **99.0%** | **+59.4 п.п.** ⭐ |
| **25 чел** | **47.3%** | **98.6%** | **+51.3 п.п.** ⭐ |
| **51 чел** | **63.4%** | **98.1%** | **+34.7 п.п.** |
| **119 чел** | **75.9%** | **97.8%** | **+21.9 п.п.** |
| 168 чел | 82.3% | 98.4% | +16.0 п.п. |
| 201 чел | 88.4% | 98.9% | +10.6 п.п. |
| 375 чел | 96.8% | 99.2% | +2.4 п.п. |

### Ключевые результаты

**1. Критический порог эффективности: 18+ человек**
- При 10-13 чел оба метода показывают низкие результаты (<40% SR)
- При 18+ чел генетический алгоритм достигает **98-99% SR**

**2. Максимальное улучшение: группы 18-51 человек**
- Улучшение на **+34-59 процентных пунктов**
- Традиционный метод: 39-63% SR (каждая вторая группа провалится)
- Генетический алгоритм: 98-99% SR (практически гарантированный успех)

**3. Значительное улучшение: группы 51-119 человек**
- Улучшение на **+22-35 процентных пунктов**
- Традиционный метод: 63-76% SR (каждая 3-4 группа провалится)
- Генетический алгоритм: 98% SR (только 2% провалов)

**4. Умеренное улучшение: группы 168-375 человек**
- Улучшение на **+2-16 процентных пунктов**
- Традиционный метод: 82-97% SR (уже достаточно надежно)
- Генетический алгоритм: 98-99% SR (еще более надежно)

---

### Практические рекомендации

**Когда использовать генетический алгоритм:**

| Размер группы | Традиционный метод | Генетический алгоритм | Рекомендация |
|---------------|-------------------|---------------------|--------------|
| <18 чел | SR <42% | SR <40% | ❌ Оба метода ненадежны |
| 18-50 чел | SR 40-63% | SR 98-99% | ✅ **Обязательно использовать алгоритм** |
| 51-140 чел | SR 63-76% | SR 98% | ✅ **Настоятельно рекомендуется** |
| 141-299 чел | SR 54-88% | SR 98% | ✅ **Рекомендуется** (выход из "зоны иллюзии") |
| 300+ чел | SR 92%+ | SR 99% | ✓ Опционально (небольшое улучшение) |

**Пример оптимальной матрицы:**

```
Success Rate: 98.8%

                Rating 1  Rating 2  Rating 3  Rating 4  Rating 5
CR [0.0-0.80)      3.5%      6.8%     10.2%     13.5%     16.8%
CR [0.80-0.90)     2.8%      5.9%      9.1%     12.2%     15.3%
CR [0.90-1.10)     2.1%      5.0%      8.0%     11.0%     14.0%
CR [1.10-1.20)     1.4%      4.1%      6.9%      9.6%     12.3%
CR [1.20-∞)        0.7%      3.2%      5.8%      8.3%     10.8%

Метрики:
├─ 98.8% сценариев попадают в бюджет ±5%
├─ Все принципы справедливости соблюдены
└─ Среднее отклонение: 0.84% от целевого бюджета
```

---

### Выводы

**Генетический алгоритм решает фундаментальную проблему традиционного метода:**

✅ **Расширяет применимость** с 300+ до 18+ человек  
✅ **Повышает надежность** для групп 18-140 чел с 40-76% до 98%  
✅ **Максимально эффективен** для групп 18-51 чел (улучшение +34-59 п.п.)  
✅ **Делает метод применимым** для 85-90% бизнес-контекстов вместо 15-20%

**Ограничения:**
- Для групп <18 человек даже оптимизация не преодолевает фундаментальную проблему малой выборки
- Для таких групп рекомендуется использовать альтернативные подходы (объединение с другими функциями или индивидуальный подход)

---

### Коммерческое применение

Генетический алгоритм используется Lens Consulting в консалтинговых проектах по Compensation & Benefits для:
- Компаний с функциональными группами 18-300 человек
- Организаций, где традиционный метод показывает низкую надежность
- Проектов, требующих высокой точности бюджетирования (98%+ SR)

**Для коммерческого использования:** Свяжитесь с Lens Consulting

---

## ✅ ВСЁ!

**Что убрали:**
- ❌ Весь раздел "Технические решения"
- ❌ Описание библиотек
- ❌ Код на Python
- ❌ Детали реализации (fitness функция, кроссовер, мутация, etc.)
- ❌ Технические ноу-хау

**Что оставили:**
- ✅ Концепцию решения
- ✅ Результаты (таблица сравнения)
- ✅ Выводы
- ✅ Практические рекомендации
- ✅ Пример оптимальной матрицы

**Добавили:**
- ✅ Примечание о конфиденциальности кода
- ✅ Ссылку на приватный репозиторий для комиссии
- ✅ Упоминание коммерческого использования

Теперь это описание результатов исследования, а не техническая документация к коду!

## Общие выводы

### Трехэтапный проект

**Этап 1: Валидация (Monte Carlo)**
- **Данные:** Реальные рыночные данные по состоянию на 1 мая 2025 года
  - 300+ компаний в Москве
  - Полная функциональная вертикаль (от самых младших должностей до топ-менеджмента)
  - 2,921 функциональная группа (Company × Function)
  - 383,000+ сотрудников
- **Методология:** Monte Carlo симуляция (50,000 итераций на группу)
- **Результат:** Метод математически корректен, но требует 300-400+ сотрудников для надежности. Выявлена "зона опасной иллюзии" (141-299 чел), где средние SR 81-88% маскируют 22-46% риск провала.

**Этап 2: Детальный анализ**
- Размер группы объясняет ~85-90% вариации в надежности
- Конфигурация матрицы влияет минимально (±6%)
- **Парадокс высоких средних:** средняя SR=88% не гарантирует надежность из-за бимодального распределения
- **Фундаментальное противоречие:** статистика требует 300-400+ человек, но <20% функций достигают этого порога. Метод непригоден для 70-75% бизнес-контекстов.

**Этап 3: Решение (Генетический алгоритм)**
- **Критический порог: работает для групп от 18+ человек** (SR 98-99%)
- **Максимальный эффект для групп 18-51 чел:** улучшение на **+34-59 процентных пунктов** (с 40-63% до 98-99%)
- **Значительный эффект для групп 51-140 чел:** улучшение на **+22-35 п.п.** (с 63-76% до 98%)
- **Умеренный эффект для групп 141-375 чел:** улучшение на **+2-16 п.п.** (с 82-97% до 98-99%)
- **Применим для 85-90% бизнес-контекстов**, где традиционный метод ненадежен

---

### Практическая ценность

**Для HR:**
- **Понимание критических ограничений:** традиционный метод требует 300+ человек, "зона иллюзии" 141-299 чел опасна
- **Генетический алгоритм решает проблему 85-90% функций:**
  - Расширяет применимость с 300+ до 18+ человек
  - Особенно эффективен для критических групп 18-140 чел (улучшение +22-59 п.п.)
- **Количественная оценка рисков:** четкое понимание, какие функции нуждаются в оптимизации
- **Автоматизация:** создание справедливых merit matrices с гарантированным соблюдением constraints

**Для Finance:**
- **Кардинальное снижение бюджетных рисков:**
  - Группы 18-51 чел: риск провала с 37-60% до 1-2%
  - Группы 51-140 чел: риск провала с 24-37% до 2%
  - Группы 141-300 чел: риск провала с 8-22% до 1-2%
- **Предсказуемость:** 98-99% вероятность попадания в бюджет ±5% для всех функций 18+ человек
- **Data-driven аргументация:** количественное обоснование решений для CFO и совета директоров

**Для бизнеса:**
- **Радикальное расширение применимости:** с 15-20% (только крупнейшие функции 300+) до 85-90% (все функции 18+)
- **Универсальность решения:** один метод для компаний от 100 до 100,000+ сотрудников
- **Гарантия справедливости:** автоматические constraints предотвращают дискриминацию и обеспечивают корректную дифференциацию
- **Бизнес-эффект:** снижение незапланированных расходов на 50-70% для функций <300 чел

---

### Научный вклад

1. **Первое систематическое исследование** точности aggregated distributions method на реальных рыночных данных (383K+ сотрудников, 2,921 группа, 146+ миллионов Monte Carlo итераций)

2. **Выявление критических порогов и "зоны иллюзии":**
   - Количественное определение границ применимости традиционного метода (300-400+ чел)
   - Открытие парадокса высоких средних (почему средняя SR=88% обманчива)
   - Детальная характеристика "зоны иллюзии" 141-299 чел

3. **Количественная оценка практической неприменимости:** только 15-20% бизнес-контекстов могут надежно использовать традиционный метод

4. **Разработка и валидация практического решения:**
   - Генетический алгоритм расширяет применимость с 15-20% до 85-90% контекстов
   - Критический порог снижен с 300+ до 18+ человек
   - Улучшение надежности на +22-59 процентных пунктов для критических групп
   - Валидация на реальных данных подтверждает 98-99% success rate

5. **Мост между теорией и практикой:** 
   - Коммерческое применение академических методов (генетические алгоритмы, Monte Carlo)
   - Решение реальной HR/Finance проблемы для 85-90% компаний
   - Автоматизация сложного процесса создания merit matrices

---

### Ключевые рекомендации

**Универсальное правило с учетом генетического алгоритма:**

| Размер группы | Традиционный метод | Генетический алгоритм | Рекомендация |
|---------------|-------------------|---------------------|--------------|
| **<18 чел** | SR <42% ❌ | SR <40% ❌ | **Оба метода ненадежны** — требуется альтернативный подход |
| **18-50 чел** | SR 40-63% ❌ | SR 98-99% ✅ | **ОБЯЗАТЕЛЬНО используйте алгоритм** (+34-59 п.п.) |
| **51-140 чел** | SR 63-76% ⚠️ | SR 98% ✅ | **НАСТОЯТЕЛЬНО рекомендуется** (+22-35 п.п.) |
| **141-299 чел** | SR 54-88% ⚠️ | SR 98% ✅ | **Рекомендуется** (выход из "зоны иллюзии") |
| **300-399 чел** | SR 92% ✅ | SR 99% ✅ | Опционально (небольшое улучшение +7 п.п.) |
| **400+ чел** | SR 98%+ ✅ | SR 99%+ ✅ | Опционально (минимальное улучшение +1-2 п.п.) |

**По размеру компаний:**

**<500 чел:**
- Традиционный: Неприменим (0% функций достигают порога 300+)
- С алгоритмом: Применим для 80-90% функций (почти все функции >18 чел)

**500-1,000 чел:**
- Традиционный: Неприменим для большинства (0-10% функций достигают 300+)
- С алгоритмом: Применим для 85-95% функций

**1,000-3,000 чел:**
- Традиционный: Частично применим (10-20% крупнейших функций)
- С алгоритмом: Применим для 90-95% функций

**3,000-10,000 чел:**
- Традиционный: Применим для 15-30% крупнейших функций
- С алгоритмом: Применим для 90-95% функций

**10,000+ чел:**
- Традиционный: Применим для 30-40% крупнейших функций
- С алгоритмом: Применим для 95%+ функций

**Критические предупреждения:**

1. **Группы <18 человек:** Даже генетический алгоритм не преодолевает фундаментальную проблему малой выборки. Рекомендуется:
   - Объединение с другими функциями для достижения 18+ человек
   - Индивидуальный подход к compensation review
   - Использование альтернативных методов (не merit matrix)

2. **"Зона иллюзии" (141-299 чел):** Традиционный метод показывает обманчиво высокие средние SR (81-88%), но 22-46% групп всё равно провалятся. Генетический алгоритм критически важен для этой зоны.

3. **Функции 18-140 чел:** Это критический диапазон, где генетический алгоритм обеспечивает максимальный эффект (+22-59 п.п.). Использование традиционного метода здесь создает неприемлемый бизнес-риск.

---

## Статус проекта

**Академическое исследование** (Этапы 1-2): Завершено
- Валидация метода на данных 383K+ сотрудников
- Анализ результатов и выявление ограничений
- Публикация результатов (данный документ)

**Коммерческое решение** (Этап 3):
- Генетический алгоритм разработан и валидирован
- Доступен исключительно клиентам Lens Consulting
- Применяется в консалтинговых проектах по C&B
